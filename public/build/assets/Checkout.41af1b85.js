import{_ as p}from"./AppLayout.0075d409.js";import{_ as v,u as b,o as r,c as k,w as _,C as x,a as e,l as d,U as m,R as f,e as n,f as w,i as I,t as c,g as a,F as C}from"./app.c8ed5195.js";import"./ResponsiveNavLink.7cde0fd6.js";import"./Banner.a041f3e7.js";import"./DropdownLink.8bb0b36d.js";import"./NavLink.3a584a96.js";const P={props:{user:Object},data(){return{orderItems:{},form:b({address:null,delivery_type:"home",delivery_fee:250,name:this.user.name,email:this.user.email,phone:this.user.phone}),loading:!1,checkoutId:null}},methods:{makePayment(){this.loading=!0;let l={phone:this.form.phone,amount:Math.round(this.orderItems.grand_total+this.form.delivery_fee),invoice_no:this.orderItems.invoice_no,email:this.form.email,delivery_type:this.form.delivery_type,delivery_fee:this.form.delivery_fee,address:this.form.address,name:this.form.name};window.axios.post(route("make.mpesa.payment"),l).then(o=>{console.log(o.data.status),this.checkoutId=o.data.checkoutId,o.data.status===200&&(Swal.fire({title:o.data.message,icon:"success",timerProgressBar:!1,showConfirmButton:!0,confirmButtonText:"Confirm Payment"}).then(i=>{i.isConfirmed?this.checkPaymentStatus(o.data.checkoutId):i.isDenied&&Swal.fire("Changes are not saved","","info")}),this.loading=!1)})},registerurl(){window.axios.post(route("register.urls")).then(l=>{console.log(l)})},checkPaymentStatus(l){let o={checkoutId:l,invoice_no:this.orderItems.invoice_no};window.axios.post(route("confirm.payment"),o).then(i=>{console.log(i),i.data.data.status===1?(Swal.fire({title:"Payment confirmed Successfully",icon:"success",timerProgressBar:!0,showConfirmButton:!1}),window.location.href=route("myorders")):i.data.data.status===0&&Swal.fire({title:"Payment not confirmed",icon:"warning",timerProgressBar:!1,showConfirmButton:!0,confirmButtonText:"Confirm Payment"}).then(h=>{h.isConfirmed&&this.checkPaymentStatus(this.checkoutId)})})}},mounted(){window.axios.get(route("get.orders",localStorage.getItem("orderItemready"))).then(l=>{this.orderItems=l.data.order})},components:{AppLayout:p}},S=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Checkout ",-1),B={class:"py-12"},E={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},N={class:"row"},V={class:"col-sm-8"},T={class:"bg-white p-8"},U=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h4",null,"Billing Infomation")])],-1),A={class:"row mb-3"},D={class:"col-sm-12"},K=e("label",{for:"name"},"Name",-1),L={class:"row mb-3"},M={class:"col-sm-6"},F=e("label",{for:"email"},"Email",-1),j={class:"col-sm-6"},H=e("label",{for:"phone"},[a("Phone Number"),e("small",{class:"text-red-600"},"*")],-1),O=e("div",{class:"row mb-3"},[e("div",{class:"col-12"},[e("label",{for:"",class:"mb-2"},[a("Choose where we should deliver your order "),e("small",{class:"text-red-600"},"*")])])],-1),R={class:"row mb-3"},W={class:"col-6"},q={class:"items-center pl-4 rounded border-2 border-gray-200 focus:border-green-600 peer-checked:text-green-600 hover:text-gray-600 hover:bg-gray-200 ring-green-600"},z=e("label",{for:"home",class:"py-4 ml-2 w-full text-sm font-medium text-gray-900"},"Deliver at Home",-1),G={class:"col-sm-6"},J={class:"items-center pl-4 rounded border-2 border-gray-200 peer-checked:border-green-600 peer-checked:text-green-600 hover:text-gray-600 hover:bg-gray-200 ring-green-600"},Q=e("label",{for:"school",class:"py-4 ml-2 w-full text-sm font-medium text-gray-900"},"Deliver at School ",-1),X={key:0},Y={for:"message",class:"block mb-2 text-sm font-medium text-gray-900"},Z={key:0},$={key:1},ee={key:2},oe={class:"col-sm-4"},te={class:"bg-gray-50 p-8"},se=e("h4",null,"Order Infomation",-1),re=e("h5",null,"Books",-1),le=e("hr",null,null,-1),ne={class:"pl-0 mb-4"},ie={class:"flex mb-2",style:{"max-height":"230px"}},ae={class:"h-16 w-16 mr-2"},de=["src","alt"],ce=e("br",null,null,-1),me=e("strong",null,"Price: ",-1),he=e("hr",null,null,-1),ue=e("strong",null,"Sub total",-1),_e=e("strong",null,"Tax charged",-1),fe=e("strong",null,"Delivery Fee",-1),ge=e("strong",null,"Total",-1),ye={class:"mt-5"},pe=e("div",{class:"py-4 alert alert-info"}," Note: We are only delivering in Nairobi only ",-1),ve={key:0,class:"flex"},be=e("div",{class:"spinner-border",role:"status"},null,-1),ke=e("span",{class:"ml-2"},"Please wait, Loading...",-1),xe=[be,ke],we={key:1};function Ie(l,o,i,h,t,u){const g=x("AppLayout");return r(),k(g,{title:"Checkout"},{header:_(()=>[S]),default:_(()=>[e("div",B,[e("div",E,[e("div",N,[e("div",V,[e("div",T,[U,e("div",A,[e("div",D,[K,d(e("input",{id:"name",type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.name=s)},null,512),[[m,t.form.name]])])]),e("div",L,[e("div",M,[F,d(e("input",{id:"email",type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.email=s)},null,512),[[m,t.form.email]])]),e("div",j,[H,d(e("input",{id:"phone",type:"text",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>t.form.phone=s),placeholder:"Mpesa Phone number to pay from "},null,512),[[m,t.form.phone]])])]),O,e("div",R,[e("div",W,[e("div",q,[d(e("input",{id:"home",type:"radio",value:"home",name:"delivery_type","onUpdate:modelValue":o[3]||(o[3]=s=>t.form.delivery_type=s),class:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[f,t.form.delivery_type]]),z])]),e("div",G,[e("div",J,[d(e("input",{id:"school",type:"radio",value:"school",name:"delivery_type","onUpdate:modelValue":o[4]||(o[4]=s=>t.form.delivery_type=s),class:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[f,t.form.delivery_type]]),Q])])]),t.form.delivery_type?(r(),n("div",X,[e("label",Y,[t.form.delivery_type==="home"?(r(),n("span",Z,"Enter Home Address below")):t.form.delivery_type==="school"?(r(),n("span",$,"Enter Name of the School, Student, Admission Number, Class & Address below")):(r(),n("span",ee,"Enter Name of the City/Town you are in"))]),d(e("textarea",{id:"message","onUpdate:modelValue":o[5]||(o[5]=s=>t.form.address=s),rows:"6",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-green-500 dark:focus:border-green-500",placeholder:"add more information on where we should deliver the order ..."},null,512),[[m,t.form.address]])])):w("",!0)])]),e("div",oe,[e("div",te,[se,re,le,e("ul",ne,[(r(!0),n(C,null,I(t.orderItems.order_items,(s,y)=>(r(),n("li",{key:y},[e("div",ie,[e("div",ae,[e("img",{src:s.product.featured_image,alt:s.product.name,class:"w-full h-full object-cover"},null,8,de)]),e("p",null,[e("strong",null,c(s.product.name),1),ce,e("span",null,[me,a("KES "+c(s.amount),1)])])])]))),128))]),he,e("div",null,[e("p",null,[ue,a(" KES "+c(t.orderItems.sub_total),1)]),e("p",null,[_e,a(" KES "+c(parseInt(t.orderItems.grand_total-t.orderItems.sub_total)),1)]),e("p",null,[fe,a(" KES "+c(parseInt(this.form.delivery_fee)),1)]),e("p",null,[ge,a(" KES "+c(t.orderItems.grand_total+parseInt(this.form.delivery_fee)),1)]),e("div",ye,[pe,e("button",{class:"text-decoration-none px-6 py-3 hover:bg-green-400 font-semibold rounded-md bg-gray-600 text-white",onClick:o[6]||(o[6]=(...s)=>u.makePayment&&u.makePayment(...s))},[t.loading?(r(),n("div",ve,xe)):(r(),n("span",we,"Make Payment"))])])])])])])])])]),_:1})}const Ve=v(P,[["render",Ie]]);export{Ve as default};
