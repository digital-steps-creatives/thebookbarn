import{d as _,u as q,s as E,m as H,o as e,c as h,w as t,g as c,h as u,e as o,a as r,f as s,b as n,Y as M,F as N,i as Y,t as P,n as x,B as Q,k as S}from"./app.c8ed5195.js";import{a as D}from"./DialogModal.2f20d18c.js";import{_ as v}from"./ConfirmsPassword.372d36f2.js";import{_ as I}from"./DangerButton.6b0b0e2c.js";import{_ as z}from"./InputError.89c4c510.js";import{_ as G}from"./InputLabel.ca7dce3d.js";import{_ as A}from"./PrimaryButton.74591227.js";import{_ as k}from"./SecondaryButton.0ab0333a.js";import{_ as O}from"./TextInput.8a164f72.js";import"./SectionTitle.61bd1231.js";const U={key:0,class:"text-lg font-medium text-gray-900"},W={key:1,class:"text-lg font-medium text-gray-900"},j={key:2,class:"text-lg font-medium text-gray-900"},J=r("div",{class:"mt-3 max-w-xl text-sm text-gray-600"},[r("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1),X={key:3},Z={key:0},ee={class:"mt-4 max-w-xl text-sm text-gray-600"},te={key:0,class:"font-semibold"},oe={key:1},ae=["innerHTML"],se={key:0,class:"mt-4 max-w-xl text-sm text-gray-600"},ne={class:"font-semibold"},re=["innerHTML"],ie={key:1,class:"mt-4"},ce={key:1},le=r("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[r("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1),ue={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg"},de={class:"mt-5"},me={key:0},fe={key:1},Ce={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup($){const B=$,l=_(!1),a=_(!1),d=_(!1),y=_(null),g=_(null),p=_([]),m=q({code:""}),f=E(()=>{var i;return!l.value&&((i=Q().props.value.user)==null?void 0:i.two_factor_enabled)});H(f,()=>{f.value||(m.reset(),m.clearErrors())});const K=()=>{l.value=!0,S.Inertia.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([R(),V(),b()]),onFinish:()=>{l.value=!1,a.value=B.requiresConfirmation}})},R=()=>axios.get("/user/two-factor-qr-code").then(i=>{y.value=i.data.svg}),V=()=>axios.get("/user/two-factor-secret-key").then(i=>{g.value=i.data.secretKey}),b=()=>axios.get("/user/two-factor-recovery-codes").then(i=>{p.value=i.data}),C=()=>{m.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{a.value=!1,y.value=null,g.value=null}})},L=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>b())},T=()=>{d.value=!0,S.Inertia.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess:()=>{d.value=!1,a.value=!1}})};return(i,F)=>(e(),h(D,null,{title:t(()=>[c(" Two Factor Authentication ")]),description:t(()=>[c(" Add additional security to your account using two factor authentication. ")]),content:t(()=>[u(f)&&!a.value?(e(),o("h3",U," You have enabled two factor authentication. ")):u(f)&&a.value?(e(),o("h3",W," Finish enabling two factor authentication. ")):(e(),o("h3",j," You have not enabled two factor authentication. ")),J,u(f)?(e(),o("div",X,[y.value?(e(),o("div",Z,[r("div",ee,[a.value?(e(),o("p",te," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(e(),o("p",oe," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),r("div",{class:"mt-4",innerHTML:y.value},null,8,ae),g.value?(e(),o("div",se,[r("p",ne,[c(" Setup Key: "),r("span",{innerHTML:g.value},null,8,re)])])):s("",!0),a.value?(e(),o("div",ie,[n(G,{for:"code",value:"Code"}),n(O,{id:"code",modelValue:u(m).code,"onUpdate:modelValue":F[0]||(F[0]=w=>u(m).code=w),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:M(C,["enter"])},null,8,["modelValue","onKeyup"]),n(z,{message:u(m).errors.code,class:"mt-2"},null,8,["message"])])):s("",!0)])):s("",!0),p.value.length>0&&!a.value?(e(),o("div",ce,[le,r("div",ue,[(e(!0),o(N,null,Y(p.value,w=>(e(),o("div",{key:w},P(w),1))),128))])])):s("",!0)])):s("",!0),r("div",de,[u(f)?(e(),o("div",fe,[n(v,{onConfirmed:C},{default:t(()=>[a.value?(e(),h(A,{key:0,type:"button",class:x(["mr-3",{"opacity-25":l.value}]),disabled:l.value},{default:t(()=>[c(" Confirm ")]),_:1},8,["class","disabled"])):s("",!0)]),_:1}),n(v,{onConfirmed:L},{default:t(()=>[p.value.length>0&&!a.value?(e(),h(k,{key:0,class:"mr-3"},{default:t(()=>[c(" Regenerate Recovery Codes ")]),_:1})):s("",!0)]),_:1}),n(v,{onConfirmed:b},{default:t(()=>[p.value.length===0&&!a.value?(e(),h(k,{key:0,class:"mr-3"},{default:t(()=>[c(" Show Recovery Codes ")]),_:1})):s("",!0)]),_:1}),n(v,{onConfirmed:T},{default:t(()=>[a.value?(e(),h(k,{key:0,class:x({"opacity-25":d.value}),disabled:d.value},{default:t(()=>[c(" Cancel ")]),_:1},8,["class","disabled"])):s("",!0)]),_:1}),n(v,{onConfirmed:T},{default:t(()=>[a.value?s("",!0):(e(),h(I,{key:0,class:x({"opacity-25":d.value}),disabled:d.value},{default:t(()=>[c(" Disable ")]),_:1},8,["class","disabled"]))]),_:1})])):(e(),o("div",me,[n(v,{onConfirmed:K},{default:t(()=>[n(A,{type:"button",class:x({"opacity-25":l.value}),disabled:l.value},{default:t(()=>[c(" Enable ")]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Ce as default};
